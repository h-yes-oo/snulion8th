{% extends 'base.html' %}

{% block content %}
  <body>
  {% if user.is_authenticated %} 
    <div class="new_feed">
      <a href="/feeds/new">+ new feed</a> 
    </div>
  {% endif %} 
    {% for feed in feeds %} 
      <div class="feeds">
        <p id="title">{{ feed.title }}</p>
        <p id="contents">{{ feed.content }}</p>
        <p>작성자:<strong>{{feed.author.username}}</strong>
          (following: {{ feed.author.profile.follow_to.all.count }} / follower: {{ feed.author.profile.follow_from.all.count }})
          {% if user.is_authenticated %}
            {% if request.user != feed.author %}
              <a href="/accounts/{{ feed.author.id }}/follow">
                {% if request.user.profile not in feed.author.profile.follows.all %}
                    팔로우
                {% else %}
                    팔로우 취소
                {% endif %}
              </a>
            {% endif %}
        {% endif %}
      </p>
      {% for c in feed.feedcomment_set.all %}
      <p>{{ c.content }}</p>
      {% if request.user == c.author %} 
      <form action="/feeds/{{ feed.id }}/comments/{{ c.id }}/" method="POST">
        {% csrf_token %}
        <button>댓글 삭제</button>
      </form>
      {% endif %}
      <a href="/feeds/{{ feed.id }}/comments/{{ c.id }}/like">{{ c.feedcommentlike_users.count }} Likes</a>
    {% endfor %}
    {% if user.is_authenticated %}
      <form action="/feeds/{{ feed.id }}/comments/" method="POST">
        {% csrf_token %}
        <input type="text" name="content" />
        <button type="submit">댓글 달기</button>
      </form>
    {% endif %}
        <a href="/feeds/{{ feed.id }}/like">{{ feed.like_users.count }} Likes</a>
        <a id="delete" href="/feeds/{{ feed.id }}">더보기</a>
        {% if request.user == feed.author %}
          <a id="delete" href="/feeds/{{ feed.id }}/delete" onclick="return confirm('정말 삭제하시겠습니까?')">삭제</a>
        {% endif %}
      </div>
    {% endfor %} <!-- for를 end시킨다는 뜻! 여기서는 들여쓰기로 끝을 못 내니 -->
  </body>

  {% endblock content %}
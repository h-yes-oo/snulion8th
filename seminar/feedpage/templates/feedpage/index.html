{% extends 'base.html' %}
{% block content%}
<h1>feed page</h1>
{% if user.is_authenticated %}
  <a href="{% url 'new' %}">new feed</a> 
{% endif %}
{% for feed in feeds %} 
  <div style="border: 1px solid grey;">
    <a href="/feeds/{{ feed.id }}/like">{{ feed.like_users.count }} Likes</a>
    <a href="{% url 'show' feed.id %}">더보기</a>
    {% if request.user == feed.author %}
      <a href="{% url 'delete' feed.id %}" onclick="return confirm('정말 삭제하시겠습니까?')">삭제</a> 
    {% endif %}
    <p>{{ feed.title }}</p>
    <p>{{ feed.content }}</p>
    <p>작성자:<strong>{{feed.author.username}}</strong>
      (following: {{ feed.author.profile.follow_to.all.count }} / follower: {{ feed.author.profile.follow_from.all.count }})
      {% if user.is_authenticated %}
        {% if request.user != feed.author %}
          <a href="/accounts/{{ feed.author.id }}/follow">
            {% if request.user.profile not in feed.author.profile.follows.all %}
                팔로우
            {% else %}
                팔로우 취소
            {% endif %}
          </a>
        {% endif %}
      {% endif %}
    </p>
    <br/>
    {% for c in feed.feedcomment_set.all|dictsortreversed:"like_users.count" %}
      <p>{{ c.content }}</p>
      <p>작성자:<strong>{{c.author.username}}</strong>
        <a href="/feeds/{{feed.id}}/comments/{{c.id}}/like">{{ c.like_users.count }} Likes</a>
      </p>
      {% if request.user == c.author %}
        <form action="/feeds/{{ feed.id }}/comments/{{ c.id }}/" method="POST">
          {% csrf_token %}
          <button>댓글 삭제</button>
        </form>
      {% endif %}
      <br/>
    {% endfor %}
    {% if user.is_authenticated %}
      <form action="/feeds/{{ feed.id }}/comments/" method="POST">
        {% csrf_token %}
        <input type="text" name="content" />
        <button type="submit">댓글 달기</button>
      </form>
    {% endif %}
  </div>
{% endfor %} 
{% endblock content%}